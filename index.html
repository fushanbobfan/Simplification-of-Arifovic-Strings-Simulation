<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simplified Arifovic Strings Simulation</title>
  <style>
    :root {
      --bg: #c8e3ee;
      --panel: #ffffff;
      --ink: #111827;
      --muted: #4b5563;
      --primary: #1976e6;
      --line: #d1d5db;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: Arial, sans-serif; background: var(--bg); color: var(--ink); }
    .wrap { max-width: 1150px; margin: 24px auto; background: #f8fbff; border: 2px solid #4b5563; border-radius: 20px; padding: 18px; }
    h1 { margin: 0; font-size: 42px; }
    .subtitle { margin: 8px 0 18px; font-size: 20px; color: var(--muted); }

    .main { display: grid; grid-template-columns: 320px 1fr; gap: 16px; }
    .card { background: var(--panel); border: 1px solid var(--line); border-radius: 14px; padding: 14px; }
    .control-title { margin: 0 0 10px; font-size: 34px; }
    .label { font-weight: 700; margin-top: 8px; display: block; }
    input, select { width: 100%; margin-top: 4px; padding: 8px; border: 1px solid #bfc7d1; border-radius: 8px; font-size: 16px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .btn { border: 0; border-radius: 10px; background: var(--primary); color: #fff; padding: 10px 12px; font-size: 17px; font-weight: 700; cursor: pointer; }
    .btn:hover { background: #155fbb; }
    .ghost { background: #e5e7eb; color: #111827; }
    .scenario { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; margin-top: 8px; }
    .scenario .active { background: var(--primary); color: #fff; }
    .small { font-size: 12px; color: var(--muted); margin-top: 8px; }

    .toprow { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .ticks { font-size: 26px; font-weight: 700; }
    .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 8px; }
    .stat { background: #edf2ff; border-radius: 10px; padding: 8px; }
    .stat .k { font-size: 12px; color: var(--muted); }
    .stat .v { font-size: 22px; font-weight: 700; }

    .world { border: 4px solid #e5e7eb; border-radius: 12px; background: #fff; width: 100%; aspect-ratio: 1 / 1; display: block; }
    .history { margin-top: 10px; border: 1px solid var(--line); border-radius: 10px; max-height: 210px; overflow: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { border-bottom: 1px solid var(--line); padding: 6px; text-align: left; }
    th { position: sticky; top: 0; background: #fff; }

    @media (max-width: 980px) {
      .main { grid-template-columns: 1fr; }
      h1 { font-size: 34px; }
      .stats { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Simplified Arifovic Strings Simulation</h1>
    <p class="subtitle">NetLogo-like classroom view: each agent is a literal string (short/medium/long = low/medium/high effort).</p>
    <p id="bootStatus" style="margin:0 0 10px;color:#b91c1c;font-weight:700;display:none"></p>

    <div class="main">
      <section class="card">
        <h2 class="control-title">Controls</h2>

        <span class="label">Scenario</span>
        <div class="scenario" id="scenarioButtons">
          <button class="btn ghost active" data-group="2">n = 2</button>
          <button class="btn ghost" data-group="4">n = 4</button>
          <button class="btn ghost" data-group="15">n = 15</button>
          <button class="btn ghost" data-group="all">Whole class</button>
        </div>

        <div class="row">
          <div>
            <span class="label">Agents</span>
            <input id="populationSize" type="number" min="2" value="2" />
          </div>
          <div>
            <span class="label">Seed</span>
            <input id="seed" type="number" value="42" />
          </div>
        </div>

        <div class="row">
          <div>
            <span class="label">Imitation rate</span>
            <input id="learningRate" type="number" min="0" max="1" step="0.01" value="0.20" />
          </div>
          <div>
            <span class="label">Model speed (fps)</span>
            <input id="fps" type="number" min="1" max="30" value="8" />
          </div>
        </div>

        <div class="row" style="margin-top:12px;">
          <button class="btn" id="setupBtn">setup</button>
          <button class="btn" id="goBtn">go</button>
        </div>
        <div class="row" style="margin-top:8px;">
          <button class="btn ghost" id="stepBtn">step</button>
          <button class="btn ghost" id="stopBtn">stop</button>
        </div>

        <p class="small">
          Payoff = min effort group benefit − effort cost.<br />
          Benefit: L→0, M→10, H→100. Costs: L→0, M→5, H→10.
        </p>
      </section>

      <section class="card">
        <div class="toprow">
          <strong id="scenarioLabel">n = 2</strong>
          <div class="ticks">ticks: <span id="tickLabel">0</span></div>
        </div>

        <div class="stats">
          <div class="stat"><div class="k">share L</div><div class="v" id="shareL">0%</div></div>
          <div class="stat"><div class="k">share M</div><div class="v" id="shareM">0%</div></div>
          <div class="stat"><div class="k">share H</div><div class="v" id="shareH">0%</div></div>
          <div class="stat"><div class="k">avg payoff</div><div class="v" id="avgPayoff">0.0</div></div>
        </div>

        <canvas id="world" class="world" width="700" height="700"></canvas>

        <div class="history">
          <table>
            <thead><tr><th>tick</th><th>L</th><th>M</th><th>H</th><th>avg payoff</th></tr></thead>
            <tbody id="historyBody"></tbody>
          </table>
        </div>
      </section>
    </div>
  </div>

  <script>
    window.__simBooted = false;
    window.addEventListener('error', function (e) {
      var el = document.getElementById('bootStatus');
      if (el) {
        el.style.display = 'block';
        el.textContent = 'Frontend script error: ' + e.message;
      }
    });
    function loadFallback() {
      if (window.__simBooted) return;
      var s = document.createElement('script');
      s.src = './web/app.js?v=fallback';
      document.body.appendChild(s);
      var el = document.getElementById('bootStatus');
      if (el) {
        el.style.display = 'block';
        el.textContent = 'Primary script not loaded, using fallback ./web/app.js';
      }
    }
    setTimeout(loadFallback, 1500);
  </script>
  <script src="./app.js?v=main" onerror="loadFallback()"></script>
</body>
</html>
